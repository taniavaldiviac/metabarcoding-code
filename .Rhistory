theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
axis.text.x = element_text(face = "bold", size = 12)
)
ggplot(df_dist_asv, aes(x = tipo, y = distancia, fill = tipo)) +
geom_violin(alpha = 0.6, trim = FALSE) +
geom_boxplot(width = 0.2, alpha = 0.8, outlier.color = "gray40") +
scale_fill_manual(values = colores_tipo) +
labs(
title = "ANOSIM (ASV): distancias Jaccard intra e inter región",
x = "Comparación",
y = "Distancia Jaccard"
) +
annotate(
"text",
x = 1, # posición en eje x ("Intra-región")
y = min(df_dist_asv$distancia, na.rm = TRUE),
label = paste("p =", signif(anosim_asv_res$signif, 3)),
hjust = 1, vjust = -0.5, size = 4, color = "black"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
axis.text.x = element_text(face = "bold", size = 12)
)
# Gráfico de boxplots
ggplot(df_dist_asv, aes(x = tipo, y = distancia, fill = tipo)) +
geom_violin(alpha = 0.6, trim = FALSE) +
geom_boxplot(width = 0.2, alpha = 0.8, outlier.color = "gray40") +
scale_fill_manual(values = colores_tipo) +
labs(
title = "ANOSIM (ASV): distancias Jaccard intra e inter región",
x = "Comparación",
y = "Distancia Jaccard"
) +
annotate(
"text",
x = 1, # posición en eje x ("Intra-región")
y = min(df_dist_asv$distancia, na.rm = TRUE),
label = paste("p =", signif(anosim_asv_res$signif, 3)),
hjust = 1, vjust = -1, size = 4, color = "black"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
axis.text.x = element_text(face = "bold", size = 12)
)
ggplot(df_dist_asv, aes(x = tipo, y = distancia, fill = tipo)) +
geom_violin(alpha = 0.6, trim = FALSE) +
geom_boxplot(width = 0.2, alpha = 0.8, outlier.color = "gray40") +
scale_fill_manual(values = colores_tipo) +
labs(
title = "ANOSIM (ASV): distancias Jaccard intra e inter región",
x = "Comparación",
y = "Distancia Jaccard"
) +
annotate(
"text",
x = 1, # posición en eje x ("Intra-región")
y = min(df_dist_asv$distancia, na.rm = TRUE),
label = paste("p =", signif(anosim_asv_res$signif, 3)),
hjust = 1, vjust = -1, size = 4, color = "black"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
axis.text.x = element_text(face = "bold", size = 12)
)
ggplot(df_dist_asv, aes(x = tipo, y = distancia, fill = tipo)) +
geom_violin(alpha = 0.6, trim = FALSE) +
geom_boxplot(width = 0.2, alpha = 0.8, outlier.color = "gray40") +
scale_fill_manual(values = colores_tipo) +
labs(
title = "ANOSIM (ASV): distancias Jaccard intra e inter región",
x = "Comparación",
y = "Distancia Jaccard"
) +
annotate(
"text",
x = 1, # posición en eje x ("Intra-región")
y = min(df_dist_asv$distancia, na.rm = TRUE),
label = paste("p =", signif(anosim_asv_res$signif, 3)),
hjust = 1, vjust = 1, size = 4, color = "black"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
axis.text.x = element_text(face = "bold", size = 12)
)
colores_tipo <- c("Intra-región" = "#21908C", "Inter-región" = "#440154")
ggplot(df_dist_asv, aes(x = tipo, y = distancia, fill = tipo)) +
geom_violin(alpha = 0.6, trim = FALSE) +
geom_boxplot(width = 0.2, alpha = 0.8, outlier.color = "gray40") +
scale_fill_manual(values = colores_tipo) +
labs(
title = "ANOSIM (ASV): distancias Jaccard intra e inter región",
x = "Comparación",
y = "Distancia Jaccard"
) +
annotate(
"text",
x = 1, # posición en eje x ("Intra-región")
y = min(df_dist_asv$distancia, na.rm = TRUE),
label = paste("p =", signif(anosim_asv_res$signif, 3)),
hjust = 0, vjust = -0.5, size = 4, color = "black"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
axis.text.x = element_text(face = "bold", size = 12)
)
colores_tipo <- c("Intra-región" = "#21908C", "Inter-región" = "#440154")
ggplot(df_dist_asv, aes(x = tipo, y = distancia, fill = tipo)) +
geom_violin(alpha = 0.6, trim = FALSE) +
geom_boxplot(width = 0.2, alpha = 0.8, outlier.color = "gray40") +
scale_fill_manual(values = colores_tipo) +
labs(
title = "ANOSIM (ASV): distancias Jaccard intra e inter región",
x = "Comparación",
y = "Distancia Jaccard"
) +
annotate(
"text",
x = min(as.numeric(df_dist_asv$tipo)),
y = min(df_dist_asv$distancia, na.rm = TRUE),
label = paste("p =", signif(anosim_asv_res$signif, 3)),
hjust = 0, vjust = -0.5, size = 4, color = "black"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
axis.text.x = element_text(face = "bold", size = 12)
)
ggplot(df_dist_asv, aes(x = tipo, y = distancia, fill = tipo)) +
geom_violin(alpha = 0.6, trim = FALSE) +
geom_boxplot(width = 0.2, alpha = 0.8, outlier.color = "gray40") +
scale_fill_manual(values = colores_tipo) +
labs(
title = "ANOSIM (ASV): distancias Jaccard intra e inter región",
x = "Comparación",
y = "Distancia Jaccard"
) +
annotate(
"text",
x = 1,
y = min(df_dist_asv$distancia, na.rm = TRUE),
label = paste("p =", signif(anosim_asv_res$signif, 3)),
hjust = 0, vjust = -0.5, size = 4, color = "black"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
axis.text.x = element_text(face = "bold", size = 12)
)
ggplot(df_dist_asv, aes(x = tipo, y = distancia, fill = tipo)) +
geom_violin(alpha = 0.6, trim = FALSE) +
geom_boxplot(width = 0.2, alpha = 0.8, outlier.color = "gray40") +
scale_fill_manual(values = colores_tipo) +
labs(
title = "ANOSIM (ASV): distancias Jaccard intra e inter región",
x = "Comparación",
y = "Distancia Jaccard"
) +
annotate(
"text",
x = 1,
y = min(df_dist_asv$distancia, na.rm = TRUE),
label = paste("p =", signif(anosim_asv_res$signif, 3)),
hjust = 0, vjust = -0.5, size = 4, color = "black"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
axis.text.x = element_text(face = "bold", size = 12)
)
# Gráfico de boxplots
ggplot(df_dist_asv, aes(x = tipo, y = distancia, fill = tipo)) +
geom_violin(alpha = 0.6, trim = FALSE) +
geom_boxplot(width = 0.2, alpha = 0.8, outlier.color = "gray40") +
scale_fill_manual(values = colores_tipo) +
labs(
title = "ANOSIM (ASV): distancias Jaccard intra e inter región",
x = "Comparación",
y = "Distancia Jaccard"
) +
annotate(
"text",
x = 0.5, # más a la izquierda del área del gráfico
y = 0,   # base del eje y
label = paste("p =", signif(anosim_asv_res$signif, 3)),
hjust = 0, vjust = -0.5, size = 4, color = "black"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
axis.text.x = element_text(face = "bold", size = 12)
)
# Gráfico de boxplots
ggplot(df_dist_asv, aes(x = tipo, y = distancia, fill = tipo)) +
geom_violin(alpha = 0.6, trim = FALSE) +
geom_boxplot(width = 0.2, alpha = 0.8, outlier.color = "gray40") +
scale_fill_manual(values = colores_tipo) +
labs(
title = "ANOSIM (ASV): distancias Jaccard intra e inter región",
x = "Comparación",
y = "Distancia Jaccard"
) +
annotate(
"text",
x = 0.5, # más a la izquierda del área del gráfico
y = 0,   # base del eje y
label = paste("p =", signif(anosim_asv_res$signif, 3)),
hjust = 0, vjust = -0.5, size = 4, color = "black"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
axis.text.x = element_text(face = "bold", size = 12)
)
permanova_asv_res <- vegan::adonis2(comm_filt ~ region_gc, data = nmds_asv_df, permutations = 999, method = "jaccard")
print(permanova_asv_res)
ggplot(nmds_asv_df, aes(x = MDS1, y = MDS2, color = region_gc, fill = region_gc)) +
ggforce::geom_mark_ellipse(
aes(group = region_gc, fill = region_gc, label = region_gc), # Etiqueta interna: nombre de la región
alpha = 0.2, show.legend = FALSE
) +
geom_point(size = 3, alpha = 0.85) +
geom_text(aes(label = site_id), vjust = -1, size = 3.5, fontface = "bold") +
scale_color_manual(values = colores_regiones) +
scale_fill_manual(values = c("#A6CEE3", "#B2DF8A")) +
guides(color = "none", fill = "none") +
scale_x_continuous(limits = c(-1.0, 1.0)) +
scale_y_continuous(limits = c(-1.0, 1.0)) +
labs(
title = "NMDS (Jaccard) de la composición comunitaria por región",
x = "NMDS1",
y = "NMDS2"
) +
annotate("text",
x = -1, y = -1,
label = paste("Stress =", round(nmds_asv$stress, 3)),
hjust = 0, vjust = 0, size = 4, color = "black"
) +
annotate("text",
x = -1, y = -0.9,
label = paste0("ANOSIM: R = ", round(anosim_asv_res$statistic, 2),
", p = ", signif(anosim_asv_res$signif, 3)),
hjust = 0, vjust = 0, size = 4, color = "#21908C"
) +
annotate("text",
x = -1, y = -0.8,
label = paste0("PERMANOVA: F = ", round(permanova_asv_res$F[1], 2),
", R² = ", round(permanova_asv_res$R2[1], 2),
", p = ", signif(permanova_asv_res$`Pr(>F)`[1], 3)),
hjust = 0, vjust = 0, size = 4, color = "#440154"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
panel.grid.minor = element_blank()
)
ggplot(nmds_asv_df, aes(x = MDS1, y = MDS2, color = region_gc, fill = region_gc)) +
ggforce::geom_mark_ellipse(
aes(group = region_gc, fill = region_gc, label = region_gc), # Etiqueta interna: nombre de la región
alpha = 0.2, show.legend = FALSE
) +
geom_point(size = 3, alpha = 0.85) +
geom_text(aes(label = site_id), vjust = -1, size = 3.5, fontface = "bold") +
scale_color_manual(values = colores_regiones) +
scale_fill_manual(values = c("#A6CEE3", "#B2DF8A")) +
guides(color = "none", fill = "none") +
scale_x_continuous(limits = c(-1.0, 1.0)) +
scale_y_continuous(limits = c(-1.0, 1.0)) +
labs(
title = "NMDS (Jaccard) de la composición comunitaria por región",
x = "NMDS1",
y = "NMDS2"
) +
annotate("text",
x = -1, y = -1,
label = paste("Stress =", round(nmds_asv$stress, 3)),
hjust = 0, vjust = 0, size = 4, color = "black"
) +
annotate("text",
x = -1, y = -0.9,
label = paste0("ANOSIM: R = ", round(anosim_asv_res$statistic, 2),
", p = ", signif(anosim_asv_res$signif, 3)),
hjust = 0, vjust = 0, size = 4, color = "#21908C"
) +
annotate("text",
x = -1, y = -0.8,
label = paste0("PERMANOVA: F = ", round(permanova_asv_res$F[1], 2),
", R² = ", round(permanova_asv_res$R2[1], 2),
", p = ", signif(permanova_asv_res$`Pr(>F)`[1], 3)),
hjust = 0, vjust = 0, size = 4, color = "#440154"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
panel.grid.minor = element_blank()
)
ggplot(nmds_asv_df, aes(x = MDS1, y = MDS2, color = region_gc, fill = region_gc)) +
ggforce::geom_mark_ellipse(
aes(group = region_gc, fill = region_gc, label = region_gc), # Etiqueta interna: nombre de la región
alpha = 0.2, show.legend = FALSE
) +
geom_point(size = 3, alpha = 0.85) +
geom_text(aes(label = site_id), vjust = -1, size = 3.5, fontface = "bold") +
scale_color_manual(values = colores_regiones) +
scale_fill_manual(values = c("#A6CEE3", "#B2DF8A")) +
guides(color = "none", fill = "none") +
scale_x_continuous(limits = c(-1.0, 1.0)) +
scale_y_continuous(limits = c(-1.0, 1.0)) +
labs(
title = "NMDS (Jaccard) de la composición comunitaria por región",
x = "NMDS1",
y = "NMDS2"
) +
annotate("text",
x = -1, y = -1,
label = paste("Stress =", round(nmds_asv$stress, 3)),
hjust = 0, vjust = 0, size = 4, color = "black"
) +
annotate("text",
x = -1, y = -0.9,
label = paste0("ANOSIM: R = ", round(anosim_asv_res$statistic, 2),
", p = ", signif(anosim_asv_res$signif, 3)),
hjust = 0, vjust = 0, size = 4, color = "#21908C"
) +
annotate("text",
x = -1, y = -0.8,
label = paste0("PERMANOVA: F = ", round(permanova_asv_res$F[1], 2),
", R² = ", round(permanova_asv_res$R2[1], 2),
", p = ", signif(permanova_asv_res$`Pr(>F)`[1], 3)),
hjust = 0, vjust = 0, size = 4, color = "#440154"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
panel.grid.minor = element_blank()
)
ggplot(nmds_asv_df, aes(x = MDS1, y = MDS2, color = region_gc, fill = region_gc)) +
ggforce::geom_mark_ellipse(
aes(group = region_gc, fill = region_gc, label = region_gc), # Etiqueta interna: nombre de la región
alpha = 0.2, show.legend = FALSE
) +
geom_point(size = 3, alpha = 0.85) +
geom_text(aes(label = site_id), vjust = -1, size = 3.5, fontface = "bold") +
scale_color_manual(values = colores_regiones) +
scale_fill_manual(values = c("#A6CEE3", "#B2DF8A")) +
guides(color = "none", fill = "none") +
scale_x_continuous(limits = c(-1.0, 1.0)) +
scale_y_continuous(limits = c(-1.0, 1.0)) +
labs(
title = "NMDS (Jaccard) de la composición comunitaria por región",
x = "NMDS1",
y = "NMDS2"
) +
annotate("text",
x = -1, y = -1,
label = paste("Stress =", round(nmds_asv$stress, 3)),
hjust = 0, vjust = 0, size = 4, color = "black"
) +
annotate("text",
x = -1, y = -0.9,
label = paste0("ANOSIM: R = ", round(anosim_asv_res$statistic, 2),
", p = ", signif(anosim_asv_res$signif, 3)),
hjust = 0, vjust = 0, size = 4, color = "#21908C"
) +
annotate("text",
x = -1, y = -0.8,
label = paste0("PERMANOVA: F = ", round(permanova_asv_res$F[1], 2),
", R² = ", round(permanova_asv_res$R2[1], 2),
", p = ", signif(permanova_asv_res$`Pr(>F)`[1], 3)),
hjust = 0, vjust = 0, size = 4, color = "#440154"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none",
panel.grid.minor = element_blank()
)
renv::snapshot()
renv::status()
dir.create("../final_data/figs_species_stacked", showWarnings = FALSE)
#
df <- psmelt(ps.sp.prop)
df <- df %>% filter(site_id %in% md$site_id)
df$site_id <- factor(df$site_id, levels = unique(md$site_id))
df$Species <- as.factor(df$Species)
# Ordenar de mayor a menor abundancia dentro de cada sitio
df <- df %>% arrange(site_id, desc(Abundance))
# Generar paleta de colores aleatorios contrastantes para las familias
set.seed(123)
n_species <- length(unique(df$Species))
colores_especies <- rainbow_hcl(n_species, c = 80, l = 65, start = 0, end = 360)
gp <- ggplot(df, aes(x = site_id, y = Abundance, fill = Species)) +
geom_bar(stat = "identity") +
scale_fill_manual(values = colores_especies) +
scale_y_continuous(labels = scales::number_format(accuracy = 0.01)) +
labs(
title = "Abundancia relativa por Especie",
x = "Sitio",
y = "Abundancia relativa"
) +
theme_linedraw(base_size = 11) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.95, hjust = 1, size = 8),
legend.position = "bottom",
legend.key.size = unit(0.4, "cm"),
legend.text = element_text(face = "italic", size = 6),
legend.title = element_text(face = "bold", size = 8),
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold")
) +
guides(fill = guide_legend(nrow = 15, byrow = TRUE))
print(gp)
ggsave("../final_data/figs_species_stacked/abundancia_relativa_por_especie.png", gp, width = 8, height = 8, dpi = 300)
library(ggforce)
renv::snapshot()
library(phyloseq)
library(tidyverse)
library(RColorBrewer)
library(here)
library(Biostrings)
library(vegan)
library(pheatmap)
library(dplyr)
library(tidyr)
library(tibble)
library(viridis)
library(pander,warn.conflicts = FALSE)
library(pandoc,warn.conflicts = FALSE)
library(ggsci,warn.conflicts = FALSE)
library(ggplot2)
library(ggforce)
library(dplyr)
library(strex)
library(sqldf)
library(knitr)
library(data.table)
library(filesstrings)
library(svglite)
library(kableExtra)
library(colorspace)
install.packages("ggforce")
renv::install("ggforce")
remove.packages("ggforce", lib="~/cursos/metabarcoding2025/metabarcoding-code/renv/library/R-4.3/aarch64-apple-darwin20")
remove.packages("ggforce")
renv::install("ggforce")
renv::snapshot()
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install() # Esto actualizará todos los paquetes Bioconductor
renv::snapshot()
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install(version = "3.17")
BiocManager::install()
renv::snapshot()
install.packages("knitr")
install.packages("rmarkdown")
renv::snapshot()
renv::restore()
install.packages("bioconductor")
remove.packages("BiocVersion")
renv::init(bioconductor = TRUE)
renv::init(bioconductor = TRUE)
renv::snapshot().
renv::snapshot()
renv::install(rmarkdown)
renv::install("rmarkdown")
renv::snapshot()
install.packages("xml2")
BiocManager::version()
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install(version = "3.18")
BiocManager::version()
renv::snapshot()
renv::status()
.Platform$r_arch
